{
  "max_attempts": {
    "description": "最大重试次数",
    "type": "int",
    "hint": "当LLM回复无效时，插件将尝试重新请求的最大次数。设置为0则禁用重试。",
    "default": 3
  },
  "log_context_preview": {
    "description": "调试：在重试时输出最近 N 条上下文的简要预览",
    "type": "bool",
    "hint": "仅用于调试，输出内容为裁剪后的文本，避免泄露过多信息。",
    "default": false
  },
  "context_preview_last_n": {
    "description": "上下文预览的条目数",
    "type": "int",
    "hint": "仅在启用上下文预览时生效，表示显示最近 N 条历史。",
    "default": 10
  },
  "context_preview_max_chars": {
    "description": "单条预览的最大字符数",
    "type": "int",
    "hint": "仅在启用上下文预览时生效，用于裁剪每条预览文本长度。",
    "default": 120
  },
  "retry_delay": {
    "description": "重试间隔（秒）",
    "type": "int",
    "hint": "每次重试之间的等待时间，单位为秒。",
    "default": 2
  },
  "error_keywords": {
    "description": "🎯 触发重试的错误关键词",
    "type": "text",
    "hint": "💡 当LLM回复中包含这些关键词时将触发重试。\n📝 输入格式：每行一个关键词，不区分大小写\n✅ 示例：\n  • api 返回的内容为空\n  • 网络连接超时\n  • 服务器内部错误\n⚠️ 注意：空行会被自动忽略",
    "default": "api 返回的内容为空\nAPI 返回的 completion 由于内容安全过滤被拒绝(非 AstrBot)\n网络连接超时\n服务器暂时不可用"
  },
  "always_use_system_prompt": {
    "description": "强制使用Provider的人设覆盖上下文中的system消息",
    "type": "bool",
    "hint": "开启后，重试时会移除上下文中的所有system消息，并统一使用Provider的system_prompt，避免异常/污染人设。",
    "default": true
  },
  "retryable_status_codes": {
    "description": "✅ 允许重试的HTTP状态码",
    "type": "text",
    "hint": "💡 当错误信息中包含这些HTTP状态码时允许进入重试流程。\n📝 输入格式：每行一个状态码（400-599范围）\n✅ 推荐配置：\n  • 429 (请求频率过高)\n  • 502 (网关错误)\n  • 503 (服务不可用)\n  • 504 (网关超时)\n⚠️ 注意：无效状态码会被自动忽略",
    "default": "429\n502\n503\n504"
  },
  "non_retryable_status_codes": {
    "description": "🚫 禁止重试的HTTP状态码",
    "type": "text",
    "hint": "💡 当错误信息中包含这些HTTP状态码时直接跳过重试。\n📝 输入格式：每行一个状态码（400-599范围）\n🔥 优先级：禁止重试 > 允许重试 > 错误关键词\n✅ 常见配置：\n  • 400 (请求格式错误)\n  • 401 (未授权)\n  • 403 (禁止访问)\n💭 留空表示不限制任何状态码",
    "default": "400\n401\n403"
  },
  "fallback_system_prompt": {
    "description": "备用人设(system prompt)",
    "type": "text",
    "hint": "当 Provider 未提供 system_prompt 且开启了“强制使用Provider人设”时，使用此文本作为人设。可留空。",
    "default": ""
  },
  "fallback_reply": {
    "description": "重试全部失败时的兜底回复",
    "type": "text",
    "hint": "当达到最大重试次数仍失败时，发送给用户的一段友好提示。留空则不发送消息。",
    "default": "抱歉，刚才遇到服务波动，我已自动为你重试多次仍未成功。请稍后再试或换个说法。"
  }
}
